---
layout: post
title: "Flickr API Wrapper"
excerpt: "Приложение для использования flickr.com в качестве хранилища изображений (например для блога)"
permalink: /flickr_api_wrapper/
redirect_from: /flickr-api-wrapper/
tags:
  - Ruby
  - Development
  - Flickr
  - API
date: 2016-05-12T22:41:16+03:00
---

Когда-то давно, на сервисе для фотографов от Yahoo - <a href="https://flickr.com/" target="_blank">flickr.com</a>, выдавали всем по 1ТБ места
бесплатно и навсегда. Я попал под раздачу и с тех пор не пользовался сервисом. Когда перевел блог
на <a href="https://pages.github.com/" target="_blank">github pages</a> , задумался на счет изображений, долгое время они, как наследие от вордпресса, хранились
на <a href="http://cloudinary.com/" target="_blank">cloudinary</a>, но затем я решил использовать flickr для этого.

Cервис оказался удобным для обычного использования, но не совсем подходящим для
использования как хранилище, узнав, что есть API, я решил сделать для него обертку, через
которую мне было бы удобно загружать, удалять и просматривать изображения, которые будут
использоваться в блоге, а так же быстро получать ссылки на оригиналы изображений. У такого подхода,
как мне кажется, есть куча плюсов. Быстрый <a href="https://ru.wikipedia.org/wiki/Content_Delivery_Network" target="_blank">CDN</a> , бесплатное хранение и отдача, возможность получить
изображение в разных размерах и даже квадратное.

Первая, наивная реализация была сделана за 30 минут, на простых ruby скриптах, каждый из которых
выполнял одну определенную операцию. Дальнейшим шагом было решено оформить это все в виде
веб-приложения на <a href="http://www.sinatrarb.com/" target="_blank">Sinatra</a> .

Сейчас приложение уже версии 0.5 и пока я замедлил работу над ним, так как им можно пользоваться,
а внедрение новых функций не критично. Выглядит оно как на скриншоте ниже.

<br>
<img src="https://raw.githubusercontent.com/tonymadbrain/flickr_api/master/screenshot.png">
<br>
<br>

На данный момент поддерживаются следующие функции:

* Выгрузка в sqlite базу списка фотографий загруженных в облако flickr
(выгружаются: ссылка на оригинал, заголовок, ссылка для показа превью)
* Удаление одной или нескольких фотографий из облакка
* Загрузка фотографий в облако (пока только по одной за раз)

Из технологий используются:

* `sinatra` - не рельсами едиными
* `slim` - пишем html шаблоны без %
* `flickraw` - собственно гем для работы с flickr API - <a href="https://github.com/hanklords/flickraw" target="_blank">тыц</a>
* `yaml` - держим конфиги в yaml
* `data_mapper` - легкий ORM
* `puma` - мой выбор веб-сервера для ruby проектов

Из полевых заметок:

<s>Menu in generated file</s> в первых версиях, приложение просто генерировало html с
изоражениями, а не сохраняло информацию в БД.
<s>Generate only data and show through slim template</s> была идея генерировать только данные, ну
в txt сохранять чтоли.
<s>Delete one file</s> первая реализация удаления, удаляла все изображения в облаке.
<s>Updating in background</s> Актуализация данных, об изображениях, которые хранятся в облаке,
может быть очень долгой при большом количестве файлов, поэтому она была вынесена в фоновые задачи,
за счет потоков ruby.
<s>Some js for ajax</s> удобнее когда страница не обновляется при каждом чихе.
<s>Selecting from DB</s> таки прикрутил базу данных.
<s>Updating DB</s> см. выше.
<s>Deleting with DB</s> см. выше.<br><br>
Pretty wiews? - над интерфейсом стоит еще поработать.<br><br>
Upload many files in one time - загрузка файлов пока возможна только по одному и не через ajax,
это хочется переделать.<br><br>
Rescue errors - некоторые ошибки обрабатываются, но довольно криво, это нужно сделать по
человечески.<br><br>

Также, все чаще задумываюсь о написании тестов, а еще нужно сделать нормальную инициализацию
приложения, например в случае если нет доступов к flickr (имеется ввиду, человеко понятный способ
получения необходимых для авторизации в API данных). В общем-то есть еще что допиливать, сам проект
opensource и лежит - <a href="https://github.com/tonymadbrain/flickr_api" target="_blank">здесь</a> .
